---
title: 'DATA 603 Project: Wine Quality'
output:
  word_document: default
  pdf_document: default
  html_document:
    df_print: paged
---

```{r }
wine=read.csv("https://raw.githubusercontent.com/Cali00mira/DATA-603-Project/refs/heads/main/Wine_Dataset.csv")
wine_new =wine
wine_new$free_sulfur_dioxide<- wine_new$free_sulfur_dioxide/ 1000
wine_new$total_sulfur_dioxide<- wine_new$total_sulfur_dioxide/ 1000
wine_new$density<- wine_new$density*1000
head(wine_new,5)
```
## 1. Introduction

### 1.1. MOTIVATION 
#### 1.1.1. Context

Wine, one of the oldest and most culturally significant beverages in the world, is crafted through the fermentation of grapes. Wines are broadly categorized into red, white, and rosé, with further classifications based on sweetness, aging, and regional designations. The complexity of wine lies in its sensory experience, which involves taste, aroma, texture, and appearance. While subjective evaluation by sommeliers or consumers plays a major role in determining a wine’s appeal, advances in technology now enable the quantitative analysis of chemical properties to objectively evaluate wine quality (Makwana & Hati, 2019). This project examines the factors that influence the quality of red and white wines using measurable chemical properties. Wine quality is an important determinant in the wine industry, affecting consumer preferences, pricing, and production standards. While wine quality is often perceived as either subjective (based on personal taste or expert judgment) or objective (based on quantifiable metrics), this study focuses on leveraging objective chemical characteristics to understand and predict wine quality.

#### 1.1.2. Problem 
Tyhe main problem addressed in this study is the lack of clarity and objectivity in evaluating wine quality. Traditional methods of assessing wine quality rely heavily on subjective judgments by experts or consumers, which can be inconsistent and influenced by personal preferences or biases. This subjectivity creates challenges for winemakers, distributors, and consumers in understanding and predicting the factors that lead to high-quality wines. Despite advances in winemaking, the relationship between measurable chemical properties and wine quality scores remains complex and often unclear. Winemakers may struggle to pinpoint which factors most influence quality, leading to inefficient production processes and inconsistent product standards.
This project proposes a data-driven and visual analytics approach to address this issue by Identifying Key Quality Drivers and Building Predictive Models.


#### 1.1.3. Challenges 

The overall intention of the project is to gain an understanding of wine quality and predict wine quality based on measurable chemical properties. Also, the project aims to analyze how different chemical attributes (e.g., acidity, residual sugar, alcohol content) interact and influence wine quality ratings.

### 1.2. OBJECTIVES 
#### 1.2.1. Overview 

The overall intention  of the project is to gain an understanding of wine quality and predict wine quality based on measurable chemical properties. Also, 
the project aim to analyze how different chemical attributes (e.g., acidity, residual sugar, alcohol content) interact and influence wine quality ratings.

#### 1.2.2. Goals & Research Questions 
The goal of the project is to analyze the chemical properties that have the most significant impact on wine quality through regression analysis. This will help us to answer the guiding questions:

1.What factors influence the quality of wine?
2.How do red and white wines differ in terms of quality determinants?


## 2. METHODOLOGY 

### 2.1 Data

The data set used for this project was sourced from Kaggle. The original data collection was published in Decision Support Systems and aimed to model wine preferences by collecting information on a variety of physicochemical properties. The data was originally contained within two .csv files; however, these sheets were combined and a categorical value was added to reflect the wine color. No cleaning was required. Of the combined set, 1600 entries correspond to red wine and 4899 correspond to white wine. There are 13 attributes in the combined data set. 12 of these attributes are independent variables, used to quantify the dependent variable, wine quality. Objective tests were used to quantify factors such as pH density, while sensory data was used to evaluate wine quality. A brief synopsis of each attribute is as follows:

- Fixed acidity $(g / dm^3)$: This represents tartaric acids in wine, which will not readily evaporate
- Volatile acidity $(g / dm^3)$: This refers to the amount of acetic acid, which may exude a vinegar-like taste at high concentrations
- Citric acid $(g / dm^3)$: This acid is typically used to add “freshness” or adjust the flavor of wine
- Residual sugar $(g / dm^3)$: After the fermentation process, these sugar remain and affect the relative sweetness of the wine
- Chlorides $(g / dm^3)$: Chlorides dictate the amount of salt contained within the wine.
- Free sulfur dioxide $(mg / dm^3)$: This free form SO2 inclusion prevents oxidation and microbial growth in wines
- Total sulfur dioxide $(mg / dm^3)$: This encompasses the free and bound SO2 which, at high concentrations, may alter the scent and taste
- Density $(g / cm^3)$: The wine density may be closer to water depending on the percent alcohol and sugar content
- pH: The power of Hydrogen scale determines the acidity of the wine; lower values will be more acidic, while high values will be more basic
- Sulphates $(g / dm^3)$: Sulfates are added to wine and may affect SO2 levels
- Alcohol (% by volume): This represents the alcohol content of the wine 
- Wine type (red or white): This is the only categorical variable in the data set.
- Quality: This is given as a score between 1 and 10 and is determined by wine tasters, based on sensory data

#### 2.2 Approach

To explore the problem, multiple regression modelling will be used to investigate the relationships.This project will begin with cleaning the dataset and addressing any null or missing values as needed.
then  assessing the variables to  ensure consistency in units and formats across all chemical properties will be done. The models building will follow a structured workflow: 
starting with a first-order additive model, progressing to an interaction model, and finally incorporating higher-order terms to capture non-linear relationships. At each stage, checks and validation will be done
both before and after model construction, to ensure accuracy and reliability.Finally residuals will be analyze to further assess the fit and prediction capabilities of the model.

#### 2.3 Workflow 
The first step will be to derive the full additive model and conduct the individual t-test for each variable within the dataset. Based on the results of the t-test variable will be dropped and an F-test will be conducted to verify the validity of the reduced model. Other tests such as the stepwise, forward selection, backward elimination, and all possible regressions selection procedures will be done with the full additive model. Along the way, partial F-tests will be carried out to assess further variables that are considered for elimination from the model.
After the Additive model is derived, the interactions will be tested to see if any is significant. Based on the results obtained, the model will be adjusted to accommodate the significant terms. For this step, an Individual t-test will be conducted, and a partial F-test will be done to assess the variables being eliminated. After the interaction model is derived, the model will be assessed for any higher-order terms. Based on the results, the model will be modified to accommodate the significantly higher-order terms. Finally, the assumptions of the model will be analyzed. The different assumptions will be investigated to determine if the model is a good fit for the data. Based on the outcome of the assumption test, the model will be adjusted to meet the assumptions, if it already doesn’t.


#### 2.4 Contributions 
Our team has collaboratively structured the workload, recognizing individual strengths and ensuring a balanced contribution from each member. 
Responsibilities are tailored to leverage specific skills, resulting in equitable efforts across the team. 
The Contributions of the team are as follows:
- Claire: Data Sourcing and Results Analysis
- Tasheika: Building of Model
- Michelle: Analyzing  Residuals

All memebers will work together to prepare the final document. 

## 3 MAIN RESULTS OF THE ANALYSIS
### 3.1 Results 
####  Data Cleaning
 
The initial data was contained in separate files depicting red and white wines. The data was merged and an additional categorical variable for wine type was added. The Wine data was checked for missing values before building the model. The units of measure varied among the predictors. The differing columns were converted to create a standard data set for analysis. The columns that will be converted are:

- free_sulfur_dioxide : Initially expressed in $mg / dm^3$, will be changed to $(g/dm^3)$
- total_sulfur_dioxide : Initially expressed in $mg / dm^3$, will be changed to $(g/ dm^3)$
- density : Initially expressed in $g / cm^3$, will be changed to $(g / dm^3)$

#### Multicollinarity Test

A multicollinearity test should be done before the model can be constructed to examine the relationship between the variables. A strong linear correlation between our predictor variables may result in issues as the coefficients can become very sensitive to small changes, and the statistical power is weakened. The test for multicollinearity was calculated using the variance inflation factors (VIF) for each variable. The VIF test shows that multicollinearity exists and may be due to the density regressors. Based on this, the density variable was removed from the model.


```{r }
library(mctest) 
model=lm(quality~fixed_acidity+volatile_acidity+citric_acid+residual_sugar+
           chlorides+free_sulfur_dioxide+density+total_sulfur_dioxide+pH+sulphates+
           alcohol+	wine_type,data=wine_new)
imcdiag(model, method="VIF")
```
 
#### First Order Model
.
To investigate the remaining variable and determine which should be included in the model, the individual t-test was conducted 
The hypothesis of the test states:

$$
\begin{aligned}
H_{0} :\beta_i &=0\\
H_{1} :\beta_i  &\ne 0, \text{Where i represents predictors in the dataset}
\end{aligned}
$$


```{r }
model=lm(quality~fixed_acidity+volatile_acidity+citric_acid+residual_sugar+
           chlorides+free_sulfur_dioxide+total_sulfur_dioxide+pH+sulphates+
           alcohol+	wine_type,data=wine_new)
summary(model)

```
The results highlight that the following variables are insignificant:

- fixed_acidity: p-value (0.90140)>$\alpha = 0.05$
- citric_acid  : p-value ( 0.22612)>$\alpha = 0.05$
- pH           :p-value (0.18121)>$\alpha = 0.05$
An Anova test was conducted to determine if the variables should be dropped. A p-value of 0.120 was found, indicating that we should reject the null hypothesis and thus remove the variables from the model.

Once the variables were removed,the reduced model yielded all predictors significant at the level of $\alpha = 0.05$. Therefore, the null hypothesis
was rejected in favor of the alternative.

```{r }
reduced_fullmodel=lm(quality~volatile_acidity+residual_sugar+chlorides+
            free_sulfur_dioxide+total_sulfur_dioxide+sulphates+
            alcohol+wine_type,data=wine_new)
summary(reduced_fullmodel)

```
```{r}
anova(reduced_fullmodel,model)
```


```{r }
library(olsrr)
stepmod=ols_step_both_p(reduced_fullmodel,p_enter = 0.05, p_remove = 0.1, details=FALSE)
summary(stepmod$model)
```

```{r}
fstepmod=ols_step_forward_p(reduced_fullmodel,p_val = 0.05, details=FALSE)
summary(fstepmod$model)
```
The stepwise, forward, and backward regression test were also proformed.The same results were achieved for each test of the 3 test.
From the results obtained from all the tests,all predictors are significant at the $\alpha = 0.05$. Therefore, we reject the null hypothesis and conclude that
the predictor variable have an effect on the quality of wine.

```{r }
Bstepmod=ols_step_backward_p(reduced_fullmodel,p_val= 0.05, details=FALSE)
summary(Bstepmod$model)
```
```{r}
ExecSubsets=ols_step_best_subset(reduced_fullmodel, details=TRUE)
ExecSubsets$metric
```

The All-Possible-Regression Selection was also conducted. From this test, it was concluded that the model that contains the 8 predictors is the best model.
```{r}
rsquare=c((ExecSubsets$metrics)$rsquare)
AdjustedR=c((ExecSubsets$metrics)$adjr)
cp=c((ExecSubsets$metrics)$cp)
AIC=c((ExecSubsets$metrics)$aic)
cbind(rsquare,AdjustedR,cp,AIC)

par(mfrow=c(2,2)) # split the plotting panel into a 2 x 2 grid
plot(cp,type = "o",pch=10, xlab="Number of Variables",ylab= "Cp")
plot(rsquare,type = "o",pch=10, xlab="Number of Variables",ylab= "R^2")
plot(AIC,type = "o",pch=10, xlab="Number of Variables",ylab= "AIC")
plot(AdjustedR,type = "o",pch=10, xlab="Number of Variables",ylab= "Adjusted R^2")
```

The individual t-test along with the stepwise, forward and backward test yielded the same Adjusted R-squared of 0.2893 and lowest RSE of 0.7362. Therefore based on this,the final first order model equation can be written as:

```{r }
summary(reduced_fullmodel)
```

$$
\begin{aligned}
\hat{quality} &= 2.5923-1.5063 \cdot \text{volatile_acidity} + 0.0220  \cdot \text{residual_sugar} \\
&\quad-1.1629 \cdot \text{chlorides} + 5.7428 \cdot \text{free_sulfur_dioxide}-1.7943\cdot \text{total_sulfur_dioxide}  \\
&\quad +0.5847 \cdot \text{sulphates} +0.3350\cdot \text{alcohol}  -0.1463 \cdot \text{wine_typeWhite}
\end{aligned}
$$

The sub equations for Wine type can also be written. 
For red wine, the equation is as follows:
$$
\begin{aligned}
\hat{quality_{Red}} &= 2.5923-1.5063 \cdot \text{volatile_acidity} + 0.0220  \cdot \text{residual_sugar} \\
&\quad-1.1629 \cdot \text{chlorides} + 5.7428 \cdot \text{free_sulfur_dioxide}-1.7943\cdot \text{total_sulfur_dioxide}  \\
&\quad +0.5847 \cdot \text{sulphates} +0.3350\cdot \text{alcohol}
\end{aligned}
$$

For white wine, the equation is as follows:
$$
\begin{aligned}
\hat{quality_{White}} &= 2.5923-1.5063 \cdot \text{volatile_acidity} + 0.0220  \cdot \text{residual_sugar} \\
&\quad-1.1629 \cdot \text{chlorides} + 5.7428 \cdot \text{free_sulfur_dioxide}-1.7943\cdot \text{total_sulfur_dioxide}  \\
&\quad +0.5847 \cdot \text{sulphates} +0.3350\cdot \text{alcohol}  -0.1463 
\end{aligned}
$$

##### Interaction Model

The interaction model aims to investigate two-way interaction effects between all predictors and their impact on the response variable,quality.
By incorporating interaction terms, this model examines whether the influence of one predictor on wine quality varies depending on the value of another predictor. 
The hypothesis that is used to conduct this test is:

$$
\begin{aligned}
H_{0} :\beta_i &=0\\
H_{1} :\beta_i  &\ne 0, \text{Where i represents predictors in the dataset}
\end{aligned}
$$

```{r }
Interaction_model=lm(quality~(volatile_acidity+residual_sugar+chlorides+
            free_sulfur_dioxide+total_sulfur_dioxide+sulphates+
            alcohol+wine_type)^2,data=wine_new)
summary(Interaction_model)
```
Based on the first initial test for interactions, a number of interactions were found to be insignificant. Because of this they were eliminated from the model. 
A reduced interaction model was then constructed. This 2nd reduced interaction model yielded 13 significant interaction terms. 

```{r }
reduced_Intercation_model=lm(quality ~volatile_acidity+residual_sugar+chlorides+
            free_sulfur_dioxide+total_sulfur_dioxide+sulphates+
            alcohol+wine_type +
   volatile_acidity:total_sulfur_dioxide+
   volatile_acidity:alcohol+
   volatile_acidity:wine_type+
   residual_sugar:free_sulfur_dioxide+
   residual_sugar:total_sulfur_dioxide+
   chlorides*sulphates+
   chlorides*alcohol +
   free_sulfur_dioxide*total_sulfur_dioxide +
   free_sulfur_dioxide*sulphates +
   free_sulfur_dioxide*alcohol +
   free_sulfur_dioxide*wine_type +
   total_sulfur_dioxide*sulphates+alcohol*wine_type ,
   data = wine_new)
summary(reduced_Intercation_model)
```


From the final interaction model, when compared to the full additive model, it is seen that the the $R^2_{adj}$ has increased and the RSE has also reduced. 
From the interaction model the $R^2_{adj}$  is 0.3293 and the RSE is 0.7152. From this, it can be concluded that the Interaction model is a better predictor of the wine quality than the additive model. 


##### Higher Order Model

The model was then checked for Higher-order terms. The initial step in this process involved identifying the terms most strongly correlated with the dependent variable. This was done using the GG pairs plot. The result showed that there may be some higher order terms for alcohol, residual_sugar and free_sulfur_dioxide and volatile_acidity and chloride. Based on this finding, each variable was added to the model, to see if their higher-order terms were significant.
The results showed that all 5 terms had significant higher order terms up to the cubic level. However, with the addition of chloride’s higher-order terms, an interaction term became insignificant. Based on this, the predictor that caused this insignificance (Chloride) was removed from the model and a retest was conducted. When removed, all interactions returned to being significant. Therefore, based on this, the model with all significant interactions and higher order term higher order predictors was selected as the best model. Therefore, the model equation can be written as:

$$
\begin{aligned}
\hat{quality}&= 41.69 - 8.35 (\text{volatile_acidity}) + 0.05162 (\text{residual_sugar})\\
&+ 12.75 (\text{chlorides})- 40.23 (\text{free_sulfur_dioxide}) \\
&+ 7.82 (\text{total_sulfur_dioxide}) + 3.714 (\text{sulphates}) - 10.01 (\text{alcohol}) \\
&- 1.16 (\text{wine_typeWhite})+ 0.8971 (\text{alcohol}^2) - 0.02626 (\text{alcohol}^3) \\
&- 0.002512 (\text{residual_sugar}^2) + 0.00002571 (\text{residual_sugar}^3) \\
&- 55.87 (\text{free_sulfur_dioxide}^2) + 4.55 (\text{volatile_acidity}^2) - 2.379 (\text{volatile_acidity}^3) \\
&- 2.089 (\text{sulphates}^2) + 0.6972 (\text{sulphates}^3) \\
&+ 4.123 (\text{volatile_acidity} \times \text{total_sulfur_dioxide}) \\
&+ 0.4342 (\text{volatile_acidity} \times \text{alcohol}) - 0.8845 (\text{volatile_acidity} \times \text{wine_typeWhite}) \\
&- 0.5443 (\text{residual_sugar} \times \text{free_sulfur_dioxide}) \\
&+ 0.1567 (\text{residual_sugar} \times \text{total_sulfur_dioxide}) \\
&- 3.105 (\text{chlorides} \times \text{sulphates}) \\
&- 1.196 (\text{chlorides} \times \text{alcohol}) \\
&- 52.00 (\text{free_sulfur_dioxide} \times \text{total_sulfur_dioxide}) \\
&+ 30.41 (\text{free_sulfur_dioxide} \times \text{sulphates}) \\
&+ 2.793 (\text{free_sulfur_dioxide} \times \text{alcohol}) \\
&+ 18.47 (\text{free_sulfur_dioxide} \times \text{wine_typeWhite}) \\
&- 18.66 (\text{total_sulfur_dioxide} \times \text{sulphates}) \\
&+ 0.09142 (\text{alcohol} \times \text{wine_typeWhite}) 
+ \varepsilon
\end{aligned}
$$

```{r include=FALSE,echo=FALSE}
library(GGally)
data=wine_new[ , c('quality', 'volatile_acidity','residual_sugar','chlorides',
            'free_sulfur_dioxide','total_sulfur_dioxide','sulphates','alcohol')]

ggpairs(data,lower = list(continuous = "smooth_loess", combo =
  "facethist", discrete = "facetbar", na = "na"))


```


```{r }
rhigher_order_model=lm(quality ~ volatile_acidity+residual_sugar+chlorides+
            free_sulfur_dioxide+total_sulfur_dioxide+sulphates+
            alcohol+wine_type +
   volatile_acidity:total_sulfur_dioxide+
   volatile_acidity:alcohol+
   volatile_acidity:wine_type+
   residual_sugar:free_sulfur_dioxide+
   residual_sugar:total_sulfur_dioxide+
   chlorides*sulphates+
   chlorides*alcohol +
   free_sulfur_dioxide*total_sulfur_dioxide +
   free_sulfur_dioxide*sulphates +
   free_sulfur_dioxide*alcohol +
   free_sulfur_dioxide*wine_type +
   total_sulfur_dioxide*sulphates+alcohol*wine_type+
   I(alcohol^2)+ I(alcohol^3)+I(residual_sugar^2)+I(residual_sugar^3)+I(free_sulfur_dioxide^2)+
     I(volatile_acidity^2)+I(volatile_acidity^3)+
     I(sulphates^2)+I(sulphates^3), data = wine_new)

summary(rhigher_order_model)

```
Based on the Adjusted R-Squared of 0.3386 and RSE of 0.7102, the higher order model was selected as the best model. Compared to the additive and interactive models, it yielded the highest percent of explained variance and model fit.

## 3.2 Checking Model Assumption


The assumptions of the final higher order model were checked. This is important to ensure the validity of the model and ensure it is trustworthy. The assumptions to be tested are: 

-  Linearity
- Independence
- Equal Variance 
- Normality 
- Outliers

The multicollinearity has already been tested to determine which variables should be assessed for our model.

#### Linearity Assumption

It is assumed that there is a linear relationship between the predictors and the response, which can be assessed using residual plots.There should be
no pattern or relationship between the residuals and fitted values. Below is the residual plot:

The residuals do not appear to be randomly scattered around the horizontal line (residual = 0). Instead, there is a visible pattern, particularly a systematic curve.
This suggests that the model does not fully capture the relationship between the predictors and the response variable. 


```{r }
library(ggplot2)
ggplot(rhigher_order_model, aes(x=.fitted, y=.resid)) + geom_point() + theme_minimal()+geom_smooth() + geom_hline(yintercept = 0)

```
The actual values were plotted with the residuals to further assess this assumption. 
The actual values appear to form distinct horizontal bands. This suggests that the dependent variable (quality) is discrete or semi-discrete, which might not align perfectly with a continuous regression model. 


```{r }
wine_new$.fitted <- fitted(rhigher_order_model) 
wine_new$.resid <- residuals(rhigher_order_model)

ggplot(wine_new, aes(x=.fitted, y=.resid)) + 
  geom_point() +
  geom_smooth() + theme_minimal()+
  geom_hline(yintercept = 0) + 
  geom_point(aes(x = .fitted, y = quality), color = 'red') + 
  labs(title = "Residuals vs Fitted Values with Actual Quality", 
       x = "Fitted Values", 
       y = "Residuals")
```

####  Independence Assumption

The linear regression model assumes that the error terms are mutually independent and not correlated. The regression residuals were tested for evidence of patterns or autocorrelation using the Durbin-Watson test, with the hypothesis: 


$$
\begin{aligned}
H_{0} &:\text{no autocorrelation in residuals}\\
H_{1} &:\text{autocorrelation in residuals}
\end{aligned}
$$
```{r}
library(ggplot2)
wine_new$.fitted <- fitted(rhigher_order_model)
wine_new$.resid <- residuals(rhigher_order_model)

ggplot(wine_new, aes(x = .fitted, y = .resid, color = as.factor(wine_type))) +
  geom_point() +  
  geom_smooth(method = "loess", se = FALSE, aes(color = as.factor(wine_type))) +
  geom_hline(yintercept = 0, linetype = "dashed") +  
  labs(title = "Residuals vs Fitted Values by Wine Type", 
       x = "Fitted Values", 
       y = "Residuals") +
  scale_color_discrete(name = "Wine Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```


```{r include=FALSE,echo=TRUE}
library(car)
```

```{r }
durbinWatsonTest(rhigher_order_model)
```

The D-W test statistic has a pvalue = 0 < $\alpha$ = 0.05, therefore we reject the null hypothesis in favour of the alternative and conclude that there is autocorrelation in the residuals. Therefore this assumption is not met.


#### Equal Variance Assumption (Homoscedasticity)


```{r include=FALSE,echo=TRUE}
library(lmtest)
```


The multilinear regression model also assumes homoscedasticity, that is the errors have a constant variance. To test for this we did the Breusch-Pagan Test, where we test the hypothesis:


$$
\begin{aligned}
H_{0} &:\text {heteroscedasticity is not present(homoscedasticity)}\\
H_{1} &:\text {heteroscedasticity is present}
\end{aligned}
$$

```{r }
bptest(rhigher_order_model)
```

The BP test resulted a pvalue = 2.2e-16 < $\alpha$ = 0.05, therefore we reject the null hypothesis in favour of the alternative and conclude we do have heterscedasticity.Therefore this assumption is not met.
This is an issue as our variance varies with the data points, again lowering the statistical power of our mode


#### Normality Assumption

The normality of our errors between observed and predicted values were also tested to meet the normality assumption. This was done using a histogram and the Q-Q plot, where the hypothesis was:

$$
\begin{aligned}
H_{0} &:\text {the sample data are significantly normally distributed}\\
H_{1} &:\text {the sample data are not significantly normally distributed}
\end{aligned}
$$

```{r }
ggplot(data = wine_new, aes(residuals(rhigher_order_model))) +   geom_histogram(breaks = seq(-4, 4, by = 0.1), col = "blue",    fill = "lightblue") +
  labs(title = "Histogram of Residuals") +
  labs(x="residuals", y="Count")
```

```{r }
ggplot(wine_new, aes(sample = rhigher_order_model$residuals)) +
  stat_qq() +theme_minimal()+
  labs(title = "QQ Plot")+ 
  stat_qq_line()

```


The histogram has a bell shaped curve and Q-Q plot show the points closely lie on the diagonal line except fo the tail ends. From these plots it is concluded that the residuals follow a normal distribution,
thus meeting the normality assumption.


#### Outliers


Lastly the data was checked for outliers that may have high leverage or be influential, which would dis-proportionatly skew the results of our analysis and model. A Residuals vs Leverage plot was computed to find possible influential cases. 

```{r }
plot(rhigher_order_model, which = 5)
```
The Residuals vs Leverage plot indicates that data points #2782, #4746 and #5050 are of interest.
The second plot for Cook’s distance confirmed that data point #2782 and #4746 were influential values with a *D_i* > 1.
```{r}
plot(rhigher_order_model, poh=18, col = "red", which = c(4))
```

```{r include=FALSE,echo=TRUE}
lev = hatvalues(rhigher_order_model)
p = length(coef(rhigher_order_model))
n = nrow(wine_new)
outlier2p = lev[lev>(2*p/n)]
outlier3p = lev[lev>(3*p/n)]
#print(outlier2p)
print(outlier3p)
```

```{r}
plot(rownames(wine_new), lev, main = "Leverage in Wine Dataset", xlab = "observation", ylab = "Leverage Value")
abline(h=2*p/n, lty = 1, col = "blue")
abline(h=3*p/n, lty = 1, col = "green")
```
The leverage was evaluated by calculating the values that were greater than $2p/n$ or $3p/n$ which are thresholds used to calculate outliers. From the calculations and plots we had 140+ high leverage points.
Checks were done to see if removing the outliers would help improve the model and assist in meeting the assumptions .The results show that removing the outliers increased the adjusted r-squared value by from
 0.3386 to 0.3429.Since the increase in the Adjusted R-square is minimal, and the assumption are stil not met, the reduced higher order model will be used as the final model.
 
```{r include=FALSE,echo=TRUE}
new = wine_new[-c(4746, 2782), ]
new_model=lm(quality ~ volatile_acidity+residual_sugar+chlorides+
            free_sulfur_dioxide+total_sulfur_dioxide+sulphates+
            alcohol+wine_type +
   volatile_acidity:total_sulfur_dioxide+
   volatile_acidity:alcohol+
   volatile_acidity:wine_type+
   residual_sugar:free_sulfur_dioxide+
   residual_sugar:total_sulfur_dioxide+
   chlorides*sulphates+
   chlorides*alcohol +
   free_sulfur_dioxide*total_sulfur_dioxide +
   free_sulfur_dioxide*sulphates +
   free_sulfur_dioxide*alcohol +
   free_sulfur_dioxide*wine_type +
   total_sulfur_dioxide*sulphates+alcohol*wine_type+
   I(alcohol^2)+ I(alcohol^3)+I(residual_sugar^2)+I(residual_sugar^3)+I(free_sulfur_dioxide^2)+
     I(volatile_acidity^2)+I(volatile_acidity^3)+
     I(sulphates^2)+I(sulphates^3), data = new)

summary(new_model)
bptest(new_model)
plot(new_model,which=1)
```

#### Boxcox Trasnformation

Since our model didn’t meet the assumptions of linearity, normality and equal variance, we tried a Boxcox transformation to see if it could improve the model’s fit and assumptions. Using the boxcox method, the model yields a transformation parameter of =0.7171717. This falls both  within the confidence interval, and is extremely close to the maximum likelihood estimate, which suggests a transformation of the form below will be used. The transformation yielded no improvements in the residuals. Based on these findings, weit was concluded that no transformations should be made to the model.

```{r include=FALSE,echo=TRUE}
library(MASS) #for the boxcox()function
bc=boxcox(rhigher_order_model,lambda=seq(-1,1))
bestlambda=bc$x[which(bc$y==max(bc$y))]
bestlambda

newer_model=lm(((quality^0.7171-1)/0.7171) ~ volatile_acidity+residual_sugar+chlorides+
            free_sulfur_dioxide+total_sulfur_dioxide+sulphates+
            alcohol+wine_type +
   volatile_acidity:total_sulfur_dioxide+
   volatile_acidity:alcohol+
   volatile_acidity:wine_type+
   residual_sugar:free_sulfur_dioxide+
   residual_sugar:total_sulfur_dioxide+
   chlorides*sulphates+
   chlorides*alcohol +
   free_sulfur_dioxide*total_sulfur_dioxide +
   free_sulfur_dioxide*sulphates +
   free_sulfur_dioxide*alcohol +
   free_sulfur_dioxide*wine_type +
   total_sulfur_dioxide*sulphates+alcohol*wine_type+
   I(alcohol^2)+ I(alcohol^3)+I(residual_sugar^2)+I(residual_sugar^3)+I(free_sulfur_dioxide^2)+
     I(volatile_acidity^2)+I(volatile_acidity^3)+
     I(sulphates^2)+I(sulphates^3), data = wine_new)

summary(newer_model)
bptest(newer_model)
plot(newer_model,which=1)
```

## 4 CONCLUSION AND DISCUSSION


A regression analysis was conducted on a wine dataset with various features. The best-fit model included multiple predictors such as volatile acidity, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, sulfates, alcohol, and wine type, along with some interaction and higher-order terms. This model had the best adjusted $R^2_{adj}$ and the lowest Residual Standard Error (RSE) of 0.3386 and 0.7102 respectively.
From the model, the interpretations are as follows:

- Volatile acidity: A strong negative relationship with wine quality (coefficient = -8.35), meaning higher volatile acidity tends to lower wine quality.
- A positive relationship with wine quality (coefficient = 0.0516), suggesting that more residual sugar improves wine quality.
- Positive relationship (coefficient = 12.75), indicating that higher chloride content may improve wine quality,
- Negative relationship (coefficient = -40.23), indicating that higher levels of free sulfur dioxide negatively affect wine quality 
- Total sulfur dioxide: Positive relationship (coefficient = 7.82), implying that higher total sulfur dioxide levels improve wine quality
- Positive relationship (coefficient = 3.71), indicating that more sulphates tend to improve wine quality
- Alcohol: Negative relationship (coefficient = -10.01), suggesting that very high alcohol content could reduce wine quality (p = 8.73e-11). This might reflect non-linearity captured by higher-order terms
- Wine Type (White): Negative coefficient (-1.16), implying that white wine tends to have a lower predicted quality compared to red wine, assuming all other factors are constant.

The effects of the interaction are interpret as:

- Volatile Acidity × Total Sulfur Dioxide: High levels of both reduce the negative impact of volatile acidity on quality.
- Volatile Acidity × Alcohol: Indicates alcohol moderates the harmful effects of volatile acidity.
- Volatile Acidity × Wine Type (White) (−0.8845): Highlights that white wines with high volatile acidity tend to have reduced quality.
- Residual Sugar × Total Sulfur Dioxide (+0.1567): Indicates that higher total sulfur dioxide levels slightly offset the negative effects of residual sugar.
- Residual Sugar × Free Sulfur Dioxide : Negative interaction suggests these two together lower quality more than individually.
- Chlorides × Sulphates : Implies these components together detract from wine quality.
- Free Sulfur Dioxide × Wine Type : Strong positive effect for white wine specifically, suggesting sulfur dioxide's influence depends on wine type.
- Total Sulfur Dioxide × Sulphates: A negative interaction suggests these components together harm quality.
- Alcohol × Wine Type : Alcohol slightly boosts the quality of white wine compared to red.
- Chlorides × Alcohol (−1.196): Indicates that high alcohol and chloride levels together lower quality.
- Free Sulfur Dioxide × Total Sulfur Dioxide : Shows a strong negative impact when both forms of sulfur dioxide are elevated.
- Free Sulfur Dioxide × Sulphates : Suggests that the interaction positively affects quality, possibly balancing preservation and taste.
- Free Sulfur Dioxide × Alcohol : Indicates a positive interaction, where alcohol may temper the negative effects of free sulfur dioxide.

Assessing the Higher order terms we see that with moderate alcohol levels may improve quality, but very high levels result in diminishing returns.It can also be inferred that high residual sugar levels diminish quality, reflecting a quadratic and cubic complexity. with Free Sulfur Dioxide the negative impact becomes increasingly pronounced at higher levels.wit volatile Acidity moderate levels are less harmful, but extreme levels lead to worse outcomes due to non-linear effects.Balanced levels of Sulphates optimize quality, as excessive or insufficient sulphates reduces it. 



Assumption testing revealed that only one multicollinear variable, density, was dropped from the model, indicating that the predictors were not highly correlated. The normality assumption was met, whilst the linearity, independence and equal variance assumptions were not. This suggests that, although the residuals were normally distributed, they were not randomly distributed, showing patterns and clustering. Additionally, two outliers and over 140 leverage points were identified. The heteroscedasticity in the model brings into question the reliability if the estimated coefficients. The residuals vs fitted plot indicate that there may be a non-linear relationship between our variables or that further transformations are required to fit the model better.


#### Future Work

To enhance the model, the leverage points need to be assessed to ensure they are not distorting the model's predictions. Incorporating additional data on aging containers, types of grapes, and fermentation temperatures could be beneficial. Furthermore, classifying the wine into subtypes such as Merlot, Chardonnay, and Riesling may improve the model, as the quality metrics might differ for each subtype. 

#### Conclusion

Due to the unmet assumptions and the low $R^2_{adj}$ value, only 33.86% of the variance can be explained by the model, we are not confident that the variables provided in this dataset are good predictors of wine quality. Furthermore, the quality values were evaluated and assigned by three independent people who may have used differing parameters as measures for quality. Multilinear regression may not have been the best method for determining a predictive model given this dataset.

## 5 REFERENCES

- Makwana, M., & Hati, S. (2019, January 1). 1 - Fermented Beverages and Their Health Benefits (A. M. Grumezescu & A. M. Holban, Eds.). ScienceDirect; Woodhead Publishing. https://www.sciencedirect.com/science/article/abs/pii/B9780128152713000014
 
- P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.
 Modeling wine preferences by data mining from physicochemical properties.
 In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236. [via https://www.kaggle.com/datasets/danielpanizzo/wine-quality]
 
 - Wine Quality. (n.d.). Www.kaggle.com. https://www.kaggle.com/datasets/danielpanizzo/wine-quality
